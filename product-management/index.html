<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Dashboard - Product Management</title>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- Updated Font Awesome CDN with integrity and crossorigin attributes -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" 
        integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" 
        crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="manifest" href="/manifest.webmanifest">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="icon" href="/icon-192.png" type="image/png">
  <link rel="stylesheet" href="/styles.css">
  <link rel="stylesheet" href="product-management-responsive.css">
  <link rel="stylesheet" href="product-management-styles.css">
  <link rel="stylesheet" href="/layout/layout.css">

</head>
<body class="page-products" data-page="product-management">
  <div class="app-shell">
    <aside id="sidebar-slot"></aside>

    <div class="app-main">
      <div id="header-slot"></div>
  
  <main class="page-content">
    <div class="products-container">
      <div class="products-header">
        <h2><i class="fas fa-store"></i> Product Management</h2>
        <a class="add-product-btn" href="/add-product/">
          <i class="fas fa-plus"></i> Add Product
        </a>
      </div>
      
      <div class="products-controls">
        <div class="search-box">
          <i class="fas fa-search"></i>
          <input type="text" id="productSearch" placeholder="Search products...">
        </div>
        
        <div class="filter-controls">
          <div class="filter-dropdown">
            <select id="categoryFilter">
              <option value="all">All Categories</option>
              <option value="necklaces">Necklaces</option>
            </select>
          </div>
          
          <div class="filter-dropdown" style="margin-left: 10px;">
            <select id="stockFilter">
              <option value="all">All Stock</option>
            </select>
          </div>
          
          <div class="filter-dropdown" style="margin-left: 10px;">
            <select id="sortOrder">
              <option value="newest">Newest First</option>
              <option value="oldest">Oldest First</option>
              <option value="highest">Highest Price</option>
              <option value="lowest">Lowest Price</option>
              <option value="name-asc">Name (A-Z)</option>
              <option value="name-desc">Name (Z-A)</option>
            </select>
          </div>
        </div>
      </div>
      
      <div id="productsTableContainer">
        <!-- Loading spinner will be replaced with table when data loads -->
        <div class="loading-spinner">
          <div class="spinner"></div>
        </div>
      </div>
      
      <div class="pagination" id="productsPagination">
        <button id="prevPage" disabled><i class="fas fa-chevron-left"></i></button>
        <button class="active">1</button>
        <button id="nextPage" disabled><i class="fas fa-chevron-right"></i></button>
      </div>
    </div>

    <div class="products-container">
      <div class="products-header">
        <h2><i class="fas fa-store"></i> Archived Products</h2>
      </div>
      
      <div class="products-controls">
        <div class="search-box">
          <i class="fas fa-search"></i>
          <input type="text" id="productSearch" placeholder="Search products...">
        </div>
      </div>
      
      <div id="ArchivedproductsTableContainer">
        <!-- Loading spinner will be replaced with table when data loads -->
        <div class="loading-spinner">
          <div class="spinner"></div>
        </div>
      </div>
      
      <div class="pagination" id="productsPagination">
        <button id="prevPage" disabled><i class="fas fa-chevron-left"></i></button>
        <button class="active">1</button>
        <button id="nextPage" disabled><i class="fas fa-chevron-right"></i></button>
      </div>
    </div>
      
  </main>

        <div id="bottomnav-slot"></div>
    </div>
  </div>

  <!-- Product Edit Modal -->
  <div id="productModal" class="modal-overlay" style="display: none;">
    <div class="modal-box">
      <div class="modal-header">
        <h2 id="productModalTitle">Edit Product</h2>
        <button id="closeProductModal" class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <form id="productForm">
          <div class="form-group">
            <label for="modalName">Product Name</label>
            <input type="text" id="modalName" class="form-control" required />
          </div>
          
          <div class="form-group">
            <label for="modalPrice">Price (Â£)</label>
            <input type="number" id="modalPrice" class="form-control" min="0" step="0.01" required />
          </div>

          <!-- Variant-based Sizes Container -->
          <div class="form-group">
            <label style="display: block; text-align: center;">Will this product be available in one size only?</label>
            <div class="centered-checkboxes">
              <label><input type="radio" name="oneSizeOnly" id="oneSizeYes" /> Yes</label>
              <label><input type="radio" name="oneSizeOnly" id="oneSizeNo" /> No</label>
            </div>
          </div>

          
          <!-- One-size-only input -->
          <div class="form-group" id="singleStockContainer" style="display: none;">
            <label for="modalStock">Stock Quantity</label>
            <input type="number" id="modalStock" class="form-control" min="0" />
          </div>
          
          <!-- Multiple sizes input -->
          <div id="variantStockContainer" style="display: none;">
            <h4>Stock by Size</h4>
          
            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
              <input type="text" id="newSizeInput" class="form-control" placeholder="Enter size (e.g., S, 6, M)" />
              <button type="button" class="btn btn-outline" id="addSizeBtn">+ Add Size</button>
            </div>
          
            <div id="dynamicSizeList"></div>
          </div>


          <div class="filter-row">
            <!-- Category -->
            <div class="input-group">
              <label>Select Category</label>
              <div class="pill-options" id="categoryOptions">
                <button type="button" data-value="T-Shirts">T-Shirts</button>
              </div>
            </div>
            
            <!-- Design -->
            <div class="input-group">
              <label>Select Design</label>
              <div class="pill-options" id="designOptions">
                <button type="button" data-value="Animals">Animals</button>
                <button data-value="Add new">+ Add New</button>
              </div>
            </div>
          </div>
          
          <div class="form-group">
            <label for="modalDescription">Product Description</label>
            <textarea id="modalDescription" class="form-control" placeholder="Enter a short description..."></textarea>
          </div>

          <div class="form-group image-upload-container">
            <label for="imageUpload" class="image-upload-label">Click or drag images here</label>
            <input type="file" id="imageUpload" class="image-upload-input" multiple accept="image/*" />
            <div id="imagePreviewContainer" class="product-image-gallery"></div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button id="saveProductChanges" class="btn btn-primary">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- PWA Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js');
    }
  </script>
  

<script>
function initOptionPillToggles() {
  const categoryButtons = document.querySelectorAll("#categoryOptions button");
  const designButtons = document.querySelectorAll("#designOptions button");
  const sizeStockContainer = document.getElementById("sizeStockContainer");

  // Handle Category
  categoryButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      categoryButtons.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");

      // Show sizeStockContainer only if "T-Shirts" is selected
      const selected = btn.getAttribute("data-value");
      if (selected === "T-Shirts") {
        sizeStockContainer.style.display = "block";
      } else {
        sizeStockContainer.style.display = "none";
      }
    });
  });

  // Handle Design
  designButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      designButtons.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
    });
  });
}

// Modal setup
document.addEventListener("DOMContentLoaded", () => {
  const modal = document.getElementById("productModal");
  const openModal = document.getElementById("addProductBtn");
  const closeModal = document.getElementById("closeProductModal");

  openModal.addEventListener("click", () => {
    modal.style.display = "flex";
    // Make sure button events attach freshly every time
    setTimeout(() => initOptionPillToggles(), 50);
  });

  closeModal.addEventListener("click", () => {
    modal.style.display = "none";
  });
});

  const oneSizeYes = document.getElementById("oneSizeYes");
  const oneSizeNo = document.getElementById("oneSizeNo");
  const singleStockContainer = document.getElementById("singleStockContainer");
  const variantStockContainer = document.getElementById("variantStockContainer");
  const addSizeBtn = document.getElementById("addSizeBtn");
  const newSizeInput = document.getElementById("newSizeInput");
  const dynamicSizeList = document.getElementById("dynamicSizeList");
  
  let sizeFields = [];
  
  oneSizeYes.addEventListener("change", () => {
    if (oneSizeYes.checked) {
      singleStockContainer.style.display = "block";
      variantStockContainer.style.display = "none";
    }
  });
  
  oneSizeNo.addEventListener("change", () => {
    if (oneSizeNo.checked) {
      singleStockContainer.style.display = "none";
      variantStockContainer.style.display = "block";
    }
  });
  
  addSizeBtn.addEventListener("click", () => {
    const size = newSizeInput.value.trim();
    if (!size || sizeFields.includes(size)) return;
  
    sizeFields.push(size);
  
    const row = document.createElement("div");
    row.classList.add("form-group");
    row.innerHTML = `
      <label>Size ${size}</label>
      <input type="number" name="stock_${size}" placeholder="Qty" class="form-control" />
    `;
    dynamicSizeList.appendChild(row);
  
    newSizeInput.value = "";
  });
</script>

  <script type="module" src="/admin-auth.js"></script>
  <script type="module" src="product-management.js"></script>
  <script src="/update-popup.js"></script>
  <script type="module" src="/layout/layout.js"></script>
</body>
</html>
